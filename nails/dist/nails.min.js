class VirtualNode{constructor(e,t,i,s){this.tag=e.toUpperCase(),this.inner=i,this.atts=t,this.listeners=s}}class Box{constructor(e){this._data=e,this._dirty=!0,this._childBoxes=[],this._boxCache={}}static getKey(){return this.singleton?"singleton":void 0!==this.trackBy&&arguments.length>0?arguments[0][this.trackBy]:void 0}push(e){this._data=e,this._dirty=!0}flush(e){(e||this._dirty)&&this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}_redraw(){let e=this.render();void 0==this.element&&(this.element=document.createElement(e.tag)),this._childBoxes.length=0,this._updateNode(this.element,e,this._childBoxes),this._dirty=!1}_updateNode(e,t,i){let s=t.inner;if(this._updateElement(e,t.atts),t.listeners&&this._updateListeners(e,t.listeners),Array.isArray(s))this._updateChildren(e,s,i);else if(void 0!==s&&s instanceof VirtualNode)this._updateNode(e,s,i);else if(e.innerHTML!==s){e.innerHTML;e.innerHTML=s}}_updateChildren(e,t,i){let s=this,n=document.createDocumentFragment();t.forEach(function(e){let t;e instanceof Box?(void 0==e.element?e._redraw():i.push(e),t=e.element):e instanceof VirtualNode?(t=document.createElement(e.tag),s._updateNode(t,e,i)):(t=document.createElement("div")).innerHTML=e,n.appendChild(t)}),e.innerHTML="",e.appendChild(n)}_updateElement(e,t){for(let i in t)e.setAttribute(i,t[i])}_updateListeners(e,t){for(let i in t)e.addEventListener(i,t[i])}_(e,...t){className=e.name;let i=e.getKey.apply(e,t);if(void 0==i)return new e(...t);this._boxCache.hasOwnProperty(className)||(this._boxCache[className]={});let s=this._boxCache[className];if(s.hasOwnProperty(i)){let e=s[i];return e.push.apply(e,t),e}{let n=new e(...t);return n._key=i,s[i]=n,n}}}function extractInner(e){var t=Array.prototype.slice.call(e,1);return 1==t.length?t[0]:t}var mop={Box:Box,_boxRegister:{},box:function(e,...t){className=e.name;let i=e.getKey.apply(e,t);if(void 0==i)return new e(...t);this._boxRegister.hasOwnProperty(className)||(this._boxRegister[className]={});let s=this._boxRegister[className];if(s.hasOwnProperty(i)){let e=s[i];return e.push.apply(e,t),e}{let n=new e(...t);return n._key=i,s[i]=n,n}},_box:function(e,t){return this._boxRegister[e.name][t]},helpers:function(e,t){t.forEach(function(t){e[t]=function(e,i,s){return new VirtualNode(t,e,i,s)}})},html:{}};mop.helpers(window,["a","b","button","br","div","li","input","h1","table","td","th","tr","ul","section","span"]),ViewModel=function(e){for(var t in this._watchers=[],this._changes=[],e)this[t]=e[t]},ViewModel.prototype.flush=function(){var e=this;this._watchers.forEach(function(t){t.push(e),t.flush()}),this._changes.length=[]},ViewModel.prototype.action=function(e,t){this[e]=function(){t.apply(this,arguments),this.flush()}};