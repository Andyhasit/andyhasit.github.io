class Box{constructor(e){this._data=e,this._dirty=!0,this._childBoxes=[]}static getKey(){return this.singleton?"singleton":void 0!==this.trackBy&&arguments.length>0?arguments[0][this.trackBy]:void 0}push(e){this._data=e,this._dirty=!0}flush(e){(e||this._dirty)&&this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}_redraw(){let e=this.render();void 0==this.element&&(this.element=document.createElement(e.tag)),this._childBoxes.length=0,this._updateNode(this.element,e,this._childBoxes),this._dirty=!1}_updateNode(e,t,i){let n=t.inner;if(this._updateElement(e,t.atts),Array.isArray(n))this._updateChildren(e,n,i);else if(void 0!==n&&n.isVirtualNode)this._updateNode(e,n,i);else if(e.innerHTML!==n){e.innerHTML;e.innerHTML=n}}_updateChildren(e,t,i){let n=this,r=document.createDocumentFragment();t.forEach(function(e){let t;e instanceof mop.Box?(void 0==e.element?e._redraw():i.push(e),t=e.element):e.isVirtualNode?(t=document.createElement(e.tag),n._updateNode(t,e,i)):(t=document.createElement("div")).innerHTML=e,r.appendChild(t)}),e.innerHTML="",e.appendChild(r)}_updateElement(e,t){for(var i in t){let n=t[i];if(i.startsWith("on")&&n.startsWith("@")){let e=n.slice(1);n=`${this._eventPrefix()}.${e}`}e.setAttribute(i,n)}}_eventPrefix(){if(void 0==this._eventPrefixStr){let e=this.constructor;this._eventPrefixStr=`mop._box(${e.name}, '${this._key}')`}return this._eventPrefixStr}_updateNodeOld(e,t,i){var n,r,s=this,o=t.inner;this._updateElement(e,t.atts),Array.isArray(o)?(r=document.createDocumentFragment(),o.forEach(function(e){e instanceof mop.Box?(void 0==e.element?e._redraw():i.push(e),n=e.element):e.isVirtualNode?(n=document.createElement(e.tag),s._updateNode(n,e,i)):(n=document.createElement("div")).innerHTML=e,r.appendChild(n)}),e.innerHTML="",e.appendChild(r)):void 0!==o&&o.isVirtualNode?s._updateNode(e,o,i):(c.log(e.innerHTML),e.innerHTML=o)}}function extractInner(e){var t=Array.prototype.slice.call(e,1);return 1==t.length?t[0]:t}ViewModel=function(e){for(var t in this._watchers=[],this._changes=[],e)this[t]=e[t]},ViewModel.prototype.flush=function(){var e=this;this._watchers.forEach(function(t){t.push(e),t.flush()}),this._changes.length=[]},ViewModel.prototype.action=function(e,t){this[e]=function(){t.apply(this,arguments),this.flush()}};var mop={Box:Box,_boxRegister:{},box:function(e,...t){className=e.name;let i=e.getKey.apply(e,t);if(void 0==i)return new e(...t);this._boxRegister.hasOwnProperty(className)||(this._boxRegister[className]={});let n=this._boxRegister[className];if(n.hasOwnProperty(i)){let e=n[i];return e.push.apply(e,t),e}{let r=new e(...t);return r._key=i,n[i]=r,r}},_box:function(e,t){return this._boxRegister[e.name][t]},helpers:function(e,t){t.forEach(function(t){e[t]=function(){return new VirtualNode(t,arguments[0],extractInner(arguments))}})}};function VirtualNode(e,t,i){this.tag=e.toUpperCase(),this.inner=i,this.atts=t}VirtualNode.prototype.isVirtualNode=!0;