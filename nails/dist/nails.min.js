function BoxRegister(){this._types={},this._register={}}function copyProps(t,e){for(var o in t)e[o]=t[o]}function Box(t){for(var e in this.dirty=!0,this._nestedBoxes=[],t)this[e]=t[e]}BoxRegister.prototype.getBox=function(t,arguments){var e=this._register[t],o=this._types[t],i=o.prototype.getKey.apply(o.prototype,arguments);if(e.hasOwnProperty(i))return c.log("reusing "+t+" "+i),(n=e[i]).update.apply(n,arguments),n;c.log("building a new "+t);var n=new o;return e[i]=n,Box.call(n),n.init.apply(n,arguments),n},BoxRegister.prototype.new=function(t,e,o){var i=this;this._types[t]=function(){},this._register[t]={};var n=this._types[t];copyProps(Box.prototype,n.prototype),e.forEach(function(t){copyProps(i._types[t].prototype,n.prototype)}),copyProps(o,n.prototype),this[t]=function(){return i.getBox(t,arguments)}};var box=Box.prototype;function htmlToElement(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}function UiUtils(t,e){e.forEach(function(o){t[o]=function(){return new VirtualNode(o,arguments[0],(t=arguments,1==(e=Array.prototype.slice.call(t,1)).length?e[0]:e));var t,e}})}function VirtualNode(t,e,o){this.tag=t.toUpperCase(),this.inner=o,this.atts=e}Box.prototype.isBox=!0,Box.prototype.init=function(t){this.data=t},Box.prototype.getKey=function(){return void 0!==this.trackBy&&0<arguments.length?arguments[0][this.trackBy]:"singleton"},Box.prototype.update=function(t){this.data=t,this.dirty=!0},Box.prototype.flush=function(){this.dirty&&this.redraw(),this._nestedBoxes.forEach(function(t){t.flush()})},Box.prototype.redraw=function(){var t=this.render();null==this.element&&(this.element=document.createElement(t.tag)),this._nestedBoxes.length=0,this.applyChanges(this.element,t,this._nestedBoxes),this.dirty=!1},Box.prototype.setAttributes=function(t,e){for(var o in e)t.setAttribute(o,e[o])},Box.prototype.applyChanges=function(t,e,o){var i,n,r=this,s=e.inner;this.setAttributes(t,e.atts),Array.isArray(s)?(n=document.createDocumentFragment(),s.forEach(function(t){t.isBox?(null==t.element?t.redraw():o.push(t),i=t.element):t.isVirtualNode?(i=document.createElement(t.tag),r.applyChanges(i,t,o)):(i=document.createElement("div")).innerHTML=t,n.appendChild(i)}),t.innerHTML="",t.appendChild(n)):void 0!==s&&s.isVirtualNode?r.applyChanges(t,s,o):t.innerHTML=s},ViewModel=function(t){for(var e in this._watchers=[],this._changes=[],t)this[e]=t[e]},ViewModel.prototype.flush=function(){var e=this;this._watchers.forEach(function(t){t.update(e),t.flush()}),this._changes.length=[]},ViewModel.prototype.action=function(t,e){this[t]=function(){e.apply(this,arguments),this.flush()}},VirtualNode.prototype.isVirtualNode=!0;