const c=console;class NodeWrapper{constructor(e){this.element=e}atts(e){for(let t in e)this.element.setAttribute(t,e[t]);return this}on(e){for(let t in e)this.element.addEventListener(t,e[t]);return this}inner(e){if(Array.isArray(e)){let t=document.createDocumentFragment();e.forEach(e=>{e instanceof NodeWrapper?t.appendChild(e.element):t.appendChild(document.createTextNode(e))}),this.element.innerHTML="",this.element.appendChild(t)}else if(e instanceof NodeWrapper)this.element.innerHTML="",this.element.appendChild(e.element);else if(void 0!==e){let t=this.element.textContent,i="string"==typeof e?e:e.toString();t!==i&&(this.element.innerHTML=i)}}}class Box extends NodeWrapper{constructor(e,t){super(),this._key=t,this._boxCache={},this._elementCache={},this.update(e)}update(e){e!==this.props&&(this._dirty=!0),this.props=e,this.render()}b(){}h(e,t,i,n,s){let r=document.createElement(e),o=new NodeWrapper(r);return o.atts(t),o.inner(i),o.on(n),o}render(){m.tag("div"),m.atts(),this.inner()}tag(e,t){void 0==this.element&&(this.element=document.createElement(e)),void 0!==t&&this.atts(t)}}function createElement(e){return document.createElement(e)}class VirtualNode{constructor(e,t,i,n){this.tag=e.toUpperCase(),this.inner=i,this.atts=t,this.listeners=n}}class OldBox{constructor(e){this._data=e,this._dirty=!0,this._childBoxes=[],this._boxCache={}}static getKey(){return this.singleton?"singleton":void 0!==this.trackBy&&arguments.length>0?arguments[0][this.trackBy]:void 0}push(e){e!=e&&(this._dirty=!0),this._dirty=!0,this._data=e}flush(e){(e||this._dirty)&&this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}_redraw(){let e=this.render();void 0==this.element&&(this.element=createElement(e.tag)),this._childBoxes.length=0,this._updateNode(this.element,e,this._childBoxes),this._dirty=!1}_updateNode(e,t,i){this._updateElement(e,t.atts),t.listeners&&this._updateListeners(e,t.listeners);let n=t.inner;if(Array.isArray(n))this._processArray(e,n,i);else if(n instanceof Box)this._processBox(n,i),e.appendChild(n.element);else if(n instanceof VirtualNode){let t=createElement(n.tag);this._updateNode(t,n,i),e.innerHTML="",e.appendChild(t)}else if(void 0!==n){let t=e.innerHTML,i="string"==typeof n?n:n.toString();t!==i&&(e.innerHTML=i)}}_processBox(e,t){void 0==e.element?e._redraw():t.push(e)}_processArray(e,t,i){let n=document.createDocumentFragment();t.forEach(e=>{let t;e instanceof Box?(this._processBox(e,i),t=e.element):e instanceof VirtualNode?(t=createElement(e.tag),this._updateNode(t,e,i)):(t=createElement("div")).innerHTML=e,n.appendChild(t)}),e.innerHTML="",e.appendChild(n)}_updateElement(e,t){for(let i in t)e.setAttribute(i,t[i])}_updateListeners(e,t){for(let i in t)e.addEventListener(i,t[i])}_addCache(e,t){this._boxCache[e.name]={getKey:function(){},boxes:{}}}_(e,...t){let i=e.name,n=e.getKey.apply(e,t);if(void 0==n)return new e(...t);this._boxCache.hasOwnProperty(i)||(this._boxCache[i]={});let s=this._boxCache[i];if(s.hasOwnProperty(n)){let e=s[n];return e.push.apply(e,t),e}{let i=new e(...t);return i._key=n,s[n]=i,i}}}class TopLevelContainer extends Box{constructor(e){super(),this._id=e,this.element=document.getElementById(e)}}class ModalContainer extends TopLevelContainer{render(){return this._currentModal?h.div({id:"modal-container",style:"display: block;"},this._currentModal):h.div({id:"modal-container",style:"display: hidden;"},"")}showModal(e,t){return this._currentModal=this._(e,t),this._redraw(),new Promise((e,t)=>{this._currentModal.promise.then(t=>{this._currentModal=void 0,this._redraw(),e(t)}).catch(e=>{this._currentModal=void 0,this._redraw(),t(e)})})}}class RootBox extends Box{constructor(){super(),this.html={},this.Box=Box,this.ModalContainer=ModalContainer,this.TopLevelContainer=TopLevelContainer}flush(e){this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}addTags(e){let t=this.html;e.forEach(function(e){t[e]=function(t,i,n){return new VirtualNode(e,t,i,n)}})}action(e,t){let i=this;this[e]=function(){let e=t.apply(i,arguments);return i.flush(),e}}}const pillbug={};let tags="a b button br div form h1 h2 h3 h4 h5 li i img input label p section span table td th tr ul";pillbug.version="0.0.1",pillbug.VirtualNode=VirtualNode,pillbug.Box=Box,module.exports=pillbug;