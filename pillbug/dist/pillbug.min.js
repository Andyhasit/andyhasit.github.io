function createElement(e){return document.createElement(e)}class VirtualNode{constructor(e,t,i,s){this.tag=e.toUpperCase(),this.inner=i,this.atts=t,this.listeners=s}}class Box{constructor(e){this._data=e,this._dirty=!0,this._childBoxes=[],this._boxCache={}}static getKey(){return this.singleton?"singleton":void 0!==this.trackBy&&arguments.length>0?arguments[0][this.trackBy]:void 0}push(e){e!=e&&(this._dirty=!0),this._dirty=!0,this._data=e}flush(e){(e||this._dirty)&&this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}_redraw(){let e=this.render();void 0==this.element&&(this.element=createElement(e.tag)),this._childBoxes.length=0,this._updateNode(this.element,e,this._childBoxes),this._dirty=!1}_updateNode(e,t,i){this._updateElement(e,t.atts),t.listeners&&this._updateListeners(e,t.listeners);let s=t.inner;if(Array.isArray(s))this._processArray(e,s,i);else if(s instanceof Box)this._processBox(s,i),e.appendChild(s.element);else if(s instanceof VirtualNode){let t=createElement(s.tag);this._updateNode(t,s,i),e.innerHTML="",e.appendChild(t)}else if(void 0!==s){let t=e.innerHTML,i="string"==typeof s?s:s.toString();t!==i&&(e.innerHTML=i)}}_processBox(e,t){void 0==e.element?e._redraw():t.push(e)}_processArray(e,t,i){let s=document.createDocumentFragment();t.forEach(e=>{let t;e instanceof Box?(this._processBox(e,i),t=e.element):e instanceof VirtualNode?(t=createElement(e.tag),this._updateNode(t,e,i)):(t=createElement("div")).innerHTML=e,s.appendChild(t)}),e.innerHTML="",e.appendChild(s)}_updateElement(e,t){for(let i in t)e.setAttribute(i,t[i])}_updateListeners(e,t){for(let i in t)e.addEventListener(i,t[i])}_addCache(e,t){this._boxCache[e.name]={getKey:function(){},boxes:{}}}_(e,...t){let i=e.name,s=e.getKey.apply(e,t);if(void 0==s)return new e(...t);this._boxCache.hasOwnProperty(i)||(this._boxCache[i]={});let n=this._boxCache[i];if(n.hasOwnProperty(s)){let e=n[s];return e.push.apply(e,t),e}{let i=new e(...t);return i._key=s,n[s]=i,i}}}class TopLevelContainer extends Box{constructor(e){super(),this._id=e,this.element=document.getElementById(e)}}class ModalContainer extends TopLevelContainer{render(){return this._currentModal?h.div({id:"modal-container",style:"display: block;"},this._currentModal):h.div({id:"modal-container",style:"display: hidden;"},"")}showModal(e,t){return this._currentModal=this._(e,t),this._redraw(),new Promise((e,t)=>{this._currentModal.promise.then(t=>{this._currentModal=void 0,this._redraw(),e(t)}).catch(e=>{this._currentModal=void 0,this._redraw(),t(e)})})}}class RootBox extends Box{constructor(){super(),this.html={},this.Box=Box,this.ModalContainer=ModalContainer,this.TopLevelContainer=TopLevelContainer}flush(e){this._redraw(),this._childBoxes.forEach(function(e){e.flush()})}addTags(e){let t=this.html;e.forEach(function(e){t[e]=function(t,i,s){return new VirtualNode(e,t,i,s)}})}action(e,t){let i=this;this[e]=function(){let e=t.apply(i,arguments);return i.flush(),e}}}const pillbug=new RootBox;let tags="a b button br div form h1 h2 h3 h4 h5 li i img input label p section span table td th tr ul";pillbug.addTags(tags.split(" ")),pillbug.version="0.0.1",pillbug.VirtualNode=VirtualNode,module.exports=pillbug;