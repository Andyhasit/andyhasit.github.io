export class App{constructor(t){this._modalContainer=t,this._eventWatchers={},this._views={}}addView(t,e,s){this._views[t]=new e(this,s)}showModal(t){return this._modalContainer.inner(t),t.promise.then(t=>(this._modalContainer.clear(),t)).catch(t=>(this._modalContainer.clear(),t))}emit(t,e){this._watchers(t).forEach(t=>t(e))}on(t,e){this._watchers(t).push(e)}_watchers(t){let e=this._eventWatchers[t];return void 0==e&&(e=[],this._eventWatchers[t]=e),e}};export class View{constructor(t,e,s){this._app=t,this._key=s,this._vCache={},this._matchers={},this._vals={},this.v=this._view.bind(this),this.draw(h,this.v,t,e,s,this)}setRoot(t){return this.root=t,this.el=t.el,t}match(t,e){this._matchers.hasOwnProperty(t)||(this._matchers[t]=[]),this._matchers[t].push(e)}update(t){this._update(h,this.v,this._app,t,this._key,this)}_update(t,e,s,r,i,h){for(let t in h._matchers){let e=r[t];h._vals[t]!==e&&h._matchers[t].forEach(t=>{t(e,r)}),h._vals[t]=e}}_view(t,e,s){let r;if(void 0==s)r=new t(this._app,e);else{let i=t.name;this._vCache.hasOwnProperty(i)||(this._vCache[i]={});let h=this._vCache[i];h.hasOwnProperty(s)?r=h[s]:(r=new t(this._app,e,s),h[s]=r)}return r.update(e),r}};export class Modal extends View{draw(t,e,s,r,i,h){h.setRoot(h.overlay(t,e,s,r,i,h).on({click:t=>{t.target==h.el&&h.reject("user-cancelled")}})),h.promise=new Promise((t,e)=>{h.resolve=t,h.reject=e}),h.root.inner(h.content(t,e,s,r,i,h))}};export function h(t){return new NodeWrapper(t)};export class NodeWrapper{constructor(t){t.startsWith("#")?this.el=document.getElementById(t.substr(1)):this.el=document.createElement(t)}atts(t){for(let e in t)this.el.setAttribute(e,t[e]);return this}class(t){return this.el.className=t,this}clear(){return this.el.innerHTML="",this}on(t){for(let e in t)this.el.addEventListener(e,t[e]);return this}id(t){return this.el.id=t,this}inner(t){this.el.innerHTML="",Array.isArray(t)||(t=[t]);let e=document.createDocumentFragment();return t.forEach(t=>{t instanceof NodeWrapper||t instanceof View?e.appendChild(t.el):t instanceof Node?e.appendChild(t):e.appendChild(document.createTextNode(t.toString()))}),this.el.appendChild(e),this}html(t){return this.el.innerHTML=t,this}text(t){return this.el.textContent=t,this}};